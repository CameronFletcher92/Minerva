/*
* Kendo UI Beta v2014.2.625 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

!function(e,define){define(["./kendo.dom.min"],e)}(function(){return function(e){function t(t){var n=e(t).closest(".k-pivot-setting");return n.length?n.data("kendoPivotSettingTarget"):null}var n=window.kendo,i=n.ui,r=i.Widget,a=n.template('<p class="k-reset"><span class="k-icon #=icon#"></span>${name}</p><div class="k-list-container k-group k-reset"/>'),o=r.extend({init:function(e,t){r.fn.init.call(this,e,t),this.element.addClass("k-widget k-fieldselector k-alt k-edit-form-container"),this._dataSource(),this._layout(),this.refresh(),n.notify(this)},events:[],options:{name:"PivotConfigurator",messages:{measures:"Drop Data Fields Here",columns:"Drop Column Fields Here",rows:"Drop Rows Fields Here",measuresLabel:"Measures",columnsLabel:"Columns",rowsLabel:"Rows",fieldsLabel:"Fields"}},_dataSource:function(){this.dataSource&&this._refreshHandler?this.dataSource.unbind("change",this._refreshHandler):this._refreshHandler=e.proxy(this.refresh,this),this.dataSource=n.data.PivotDataSource.create(this.options.dataSource),this.dataSource.bind("change",this._refreshHandler)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.measures&&this.measures.setDataSource(e),this.rows&&this.rows.setDataSource(e),this.columns&&this.columns.setDataSource(e),this.refresh()},_treeViewDataSource:function(){var t=this;return n.data.HierarchicalDataSource.create({schema:{model:{id:"uniqueName",hasChildren:function(e){return!("hierarchyUniqueName"in e||"aggregator"in e)}}},transport:{read:function(n){var i,r;e.isEmptyObject(n.data)?i=t.dataSource.schemaDimensions():(r=t.treeView.dataSource.get(n.data.uniqueName),i=2==r.type?t.dataSource.schemaMeasures():r.dimensionUniqueName?t.dataSource.schemaLevels(n.data.uniqueName):t.dataSource.schemaHierarchies(n.data.uniqueName)),i.done(n.success).fail(n.error)}}})},_layout:function(){this.form=e('<div class="k-columns k-state-default k-floatwrap"/>').appendTo(this.element),this._fields(),this._targets()},_fields:function(){var n=e('<div class="k-state-default"><p class="k-reset"><span class="k-icon k-i-group"></span>'+this.options.messages.fieldsLabel+"</p></div>").appendTo(this.form);this.treeView=e("<div/>").appendTo(n).kendoTreeView({dataTextField:"name",dragAndDrop:!0,autoBind:!1,dataSource:this._treeViewDataSource(),dragstart:function(e){var t=this.dataItem(e.sourceNode);(!t.hasChildren&&!t.aggregator||2==t.type)&&e.preventDefault()},drag:function(e){var n="k-denied",i=t(e.dropTarget);i&&i.validate(this.dataItem(e.sourceNode))&&(n="k-add"),e.setStatusClass(n)},drop:function(e){var n,i;e.preventDefault(),n=t(e.dropTarget),i=this.dataItem(e.sourceNode),n&&n.validate(i)&&n.add(i.defaultHierarchy||i.uniqueName)}}).data("kendoTreeView")},_createTarget:function(t,i){return new n.ui.PivotSettingTarget(t,e.extend({dataSource:this.dataSource,template:'<li class="k-item k-header" data-'+n.ns+'name="${data.name || data}">${data.name || data}<span class="k-icon k-si-close k-setting-delete"></span></li>',emptyTemplate:'<li class="k-item k-empty">${data}</li>'},i))},_targets:function(){var t=e('<div class="k-state-default"/>').appendTo(this.form),n=e(a({name:this.options.messages.columnsLabel,icon:"k-i-vbars"})).appendTo(t),i=e('<ul class="k-pivot-configurator-settings k-list k-reset" />').appendTo(n.last()),r=e(a({name:this.options.messages.rowsLabel,icon:"k-i-hbars"})).appendTo(t),o=e('<ul class="k-pivot-configurator-settings k-list k-reset" />').appendTo(r.last()),s=e(a({name:this.options.messages.measuresLabel,icon:"k-i-sum"})).appendTo(t),l=e('<ul class="k-pivot-configurator-settings k-list k-reset" />').appendTo(s.last());this.columns=this._createTarget(i,{connectWith:o,messages:{empty:this.options.messages.columns}}),this.rows=this._createTarget(o,{setting:"rows",connectWith:i,messages:{empty:this.options.messages.rows}}),this.measures=this._createTarget(l,{setting:"measures",messages:{empty:this.options.messages.measures}})},refresh:function(){var e=this.dataSource;(this._cube!==e.cube()||this._catalog!==e.catalog())&&this.treeView.dataSource.fetch(),this._catalog=this.dataSource.catalog(),this._cube=this.dataSource.cube()},destroy:function(){r.fn.destroy.call(this),this.dataSource.unbind("change",this._refreshHandler),this.element=null,this._refreshHandler=null}});i.plugin(o)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});
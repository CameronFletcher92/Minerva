/*
* Kendo UI Beta v2014.2.625 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

!function(e,define){define(["./kendo.data.min","./kendo.userevents.min","./kendo.dataviz.core.min"],e)}(function(){return function(e,t){function n(e,t){if(null===t)return t;var n=y(e,!0);return n(t)}function i(e){return typeof e!==A}function r(e,t,n){var i,r,l=s(e),d=s(t),c=[];for(c.push(e),i=0;n>i;i++)r={r:o(l.r,d.r,i,n),g:o(l.g,d.g,i,n),b:o(l.b,d.b,i,n)},c.push(a(r));return c.push(t),c}function o(e,t,n,i){var r,o;return e=u.min(u.abs(e),u.abs(t)),t=u.max(u.abs(e),u.abs(t)),r=(t-e)/(i+1),o=r*(n+1),e+o}function a(e){return"#"+l(e.r)+l(e.g)+l(e.b)}function s(e){e=e.replace("#","");var t=d(e);return{r:c(t.r),g:c(t.g),b:c(t.b)}}function l(e){var t=u.round(e).toString(16).toUpperCase();return 1===t.length&&(t="0"+t),t}function d(e){var t=e.length,n={};return 3===t?(n.r=e[0],n.g=e[1],n.b=e[2]):(n.r=e.substring(0,2),n.g=e.substring(2,4),n.b=e.substring(4,6)),n}function c(e){return parseInt(e.toString(16),16)}var u=Math,h=e.proxy,p=window.kendo,f=p.Class,g=p.ui.Widget,m=p.template,v=p.deepExtend,_=p.data.HierarchicalDataSource,y=p.getter,w=p.dataviz,k=".kendoTreeMap",b="change",x="dataBound",C="itemCreated",T=Number.MAX_VALUE,S="mouseover"+k,D="mouseleave"+k,A="undefined",E=g.extend({init:function(e,t){g.fn.init.call(this,e,t),this.bind(this.events,this.options),this.element.addClass("k-widget k-treemap"),this.view=new P(this,this.options),this.src=new I,this._initDataSource(),this._attachEvents(),p.notify(this,w.ui)},options:{name:"TreeMap",autoBind:!0,colors:[]},events:[x,C],_attachEvents:function(){this.element.on(S,h(this._mouseover,this)).on(D,h(this._mouseleave,this))},_initDataSource:function(){var e=this,t=e.options,n=t.dataSource;e._dataChangeHandler=h(e._onDataChange,e),e.dataSource=_.create(n).bind(b,e._dataChangeHandler),n&&e.options.autoBind&&e.dataSource.fetch()},_onDataChange:function(e){var t,n,o,a,s,l,d=e.node,c=e.items,u=this.options;if(d){if(c.length){for(a=this._getByUid(d.uid),a.children=[],o=i(a.minColor)||i(a.maxColor)?r(a.minColor,a.maxColor,c.length):u.colors,n=0;c.length>n;n++)t=c[n],a.children.push(this._wrapItem(t));for(s=this.view.htmlSize(a),this.src.compute(a,a.coord,s),n=0;a.children.length>n;n++)t=a.children[n],i(t.color)||("string"==typeof o[0]?t.color=o[n%o.length]:(l=o[n%o.length],l&&(t.color=l[0],t.minColor=l[0],t.maxColor=l[1])));this.view.render(a)}}else this._items=[],t=this._wrapItem(c[0]),t.coord={width:this.element.outerWidth(),height:this.element.outerHeight(),top:0,left:0},this._items.push(t),this.view.createRoot(t),this._root=t;for(n=0;c.length>n;n++)c[n].load();this.trigger(x)},_contentSize:function(e){this.view.renderHeight(e)},_wrapItem:function(e){var t={};return i(this.options.valueField)&&(t.value=n(this.options.valueField,e)),i(this.options.colorField)&&(t.color=n(this.options.colorField,e)),i(this.options.textField)&&(t.text=n(this.options.textField,e)),t.dataItem=e,t},_getByUid:function(e){function t(n){var i,r,o;if(n.dataItem.uid===e)return n;if(i=n.children)for(r=0;i.length>r;r++){if(o=i[r],o.dataItem.uid===e)return o;t(o)}}return t(this._root)},dataItem:function(t){var n=e(t).attr(p.attr("uid")),i=this.dataSource;return i&&i.getByUid(n)},findByUid:function(e){return this.element.find(".k-treemap-tile["+p.attr("uid")+"="+e+"]")},_mouseover:function(t){var n=e(t.target);n.hasClass("k-leaf")&&(this._removeActiveState(),n.removeClass("k-state-hover").addClass("k-state-hover"))},_removeActiveState:function(){this.element.find(".k-state-hover").removeClass("k-state-hover")},_mouseleave:function(){this._removeActiveState()},destroy:function(){g.fn.destroy.call(this),this.element.off(k),this.dataSource&&this.dataSource.unbind(b,this._dataChangeHandler),p.destroy(this.element)}}),I=f.extend({leaf:function(e){return!e.children},layoutChildren:function(e,t,n){var i,r,o,a,s=n.width*n.height,l=0,d=[];for(i=0;t.length>i;i++)d[i]=parseFloat(t[i].value),l+=d[i];for(i=0;d.length>i;i++)t[i]._area=s*d[i]/l;r=this.layoutHorizontal()?n.height:n.width,t.sort(function(e,t){return(t._area>=e._area)-(e._area>=t._area)}),o=[t[0]],a=t.slice(1),this.squarify(a,o,r,n)},squarify:function(e,t,n,i){this.computeDim(e,t,n,i)},computeDim:function(e,n,i,r){var o,a,s;return e.length+n.length==1?(o=1==e.length?e:n,this.layoutLast(o,i,r),t):(e.length>=2&&0===n.length&&(n=[e[0]],e=e.slice(1)),0===e.length?(n.length>0&&this.layoutRow(n,i,r),t):(a=e[0],this.worstAspectRatio(n,i)>=this.worstAspectRatio([a].concat(n),i)?this.computeDim(e.slice(1),n.concat([a]),i,r):(s=this.layoutRow(n,i,r),this.computeDim(e,[],s.dim,s)),t))},layoutLast:function(e,t,n){e[0].coord=n},layoutRow:function(e,t,n){return this.layoutHorizontal()?this.layoutV(e,t,n):this.layoutH(e,t,n)},orientation:"h",layoutVertical:function(){return"v"===this.orientation},layoutHorizontal:function(){return"h"===this.orientation},layoutChange:function(){this.orientation=this.layoutVertical()?"h":"v"},worstAspectRatio:function(e,t){var n,i,r,o,a;if(!e||0===e.length)return T;for(n=0,i=0,r=T,o=0;e.length>o;o++)a=e[o]._area,n+=a,r=a>r?r:a,i=i>a?i:a;return u.max(t*t*i/(n*n),n*n/(t*t*r))},compute:function(e,t,n){var i,r;t.width>=t.height&&this.layoutHorizontal()||this.layoutChange(),i=e.children,i&&i.length>0&&(r={width:t.width,height:t.height-n.text,top:0,left:0},this.layoutChildren(e,i,r))},layoutV:function(e,t,n){var i,r,o,a=this._totalArea(e),s=0;for(t=u.round(a/t),i=0;e.length>i;i++)r=u.round(e[i]._area/t),e[i].coord={height:r,width:t,top:n.top+s,left:n.left},s+=r;return o={height:n.height,width:n.width-t,top:n.top,left:n.left+t},o.dim=u.min(o.width,o.height),o.dim!=o.height&&this.layoutChange(),o},layoutH:function(e,t,n){var i,r,o=this._totalArea(e),a=u.round(o/t),s=n.top,l=0;for(i=0;e.length>i;i++)e[i].coord={height:a,width:u.round(e[i]._area/a),top:s,left:n.left+l},l+=e[i].coord.width;return r={height:n.height-a,width:n.width,top:n.top+a,left:n.left},r.dim=u.min(r.width,r.height),r.dim!=r.width&&this.layoutChange(),r},_totalArea:function(e){var t,n=0;for(t=0;e.length>t;t++)n+=e[t]._area;return n}}),P=f.extend({init:function(t,n){this.options=v({},this.options,n),this.treeMap=t,this.element=e(t.element),this.offset=0},htmlSize:function(e){var t,n,i=this._getByUid(e.dataItem.uid),r={text:0,offset:0};return e.children&&(this._clean(i),t=this._getText(e),t&&(n=this._createTitle(e),i.append(n),r.text=n.height()),i.append(this._createWrap()),this.offset=(i.outerWidth()-i.innerWidth())/2),r},_getByUid:function(e){return this.element.find(".k-treemap-tile["+p.attr("uid")+"="+e+"]")},render:function(e){var t,n,i,r,o=this._getByUid(e.dataItem.uid),a=e.children;if(a)for(t=o.find(".k-treemap-wrap"),n=0;a.length>n;n++)i=a[n],r=this._createLeaf(i),t.append(r),this.treeMap.trigger(C,{element:r})},createRoot:function(e){var t=this._createLeaf(e);this.element.append(t),this.treeMap.trigger(C,{element:t})},_clean:function(e){e.css("background-color",""),e.removeClass("k-leaf"),e.empty()},_createLeaf:function(t){var n=this._createTile(t);return n.addClass("k-leaf"),i(this.options.template)?n.append(e(this._renderTemplate(t))):n.text(this._getText(t)).css("background-color",t.color).toggleClass("k-tile-inverse",this._tileColorBrightness(t)>180),n},_createTile:function(t){var n,r={width:t.coord.width,height:t.coord.height,left:t.coord.left,top:t.coord.top};return r.left&&this.offset?(r.left-=this.offset,r.width+=2*this.offset):r.width+=this.offset,r.top?(r.top-=this.offset,r.height+=2*this.offset):r.height+=this.offset,n=e("<div class='k-treemap-tile'></div>").css({width:r.width,height:r.height,left:r.left,top:r.top}),i(t.dataItem)&&i(t.dataItem.uid)&&n.attr(p.attr("uid"),t.dataItem.uid),n},_getText:function(e){var t=e.text;return this.options.template&&(t=this._renderTemplate(e)),t},_renderTemplate:function(e){var t=m(this.options.template);return t({dataItem:e.dataItem,text:e.text})},_createTitle:function(t){return e("<div class='k-treemap-title'></div>").text(this._getText(t))},_createWrap:function(){return e("<div class='k-treemap-wrap'></div>")},_tileColorBrightness:function(e){var t,n=0;return e.color&&(t=s(e.color),n=u.sqrt(.241*t.r*t.r+.691*t.g*t.g+.068*t.b*t.b)),n}});w.ui.plugin(E)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});